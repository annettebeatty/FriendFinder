<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Friends Survey Page</title>

  <!-- Latest compiled and minified CSS & JS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <style>
    .center {
      margin-left: auto;
      margin-right: auto;
      display: block;
    }

    .col-lg-4 {
      padding: 0;
    }

    body{
      background-color:darkblue;
    }
  </style>

</head>
<body>

  <div class="container">

    <div class="row">
      <div class="col-lg-12">

        <!-- Reservation Page -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-title" style="text-align: center; background-color: azure; margin-top: 15px; margin-bottom: 0px;">Survey Questions</h2>
            <hr>
          </div>

          <div class="card">
            <form role="form" id="myForm">
              <h3 class="card-header" style="text-align: center">
                About You</h3>
              <div class="card-body">
              <div class="form-group">
                <label for="your-name">Name (Required)</label>
                <input type="text" class="form-control" id="your-name" placeholder="John Doe" required />
              </div>

              <div class="form-group">
                <label for="your-pic">Link to Photo Image (Required)</label>
                <input type="text" class="form-control" id="your-pic" placeholder="URL" required/>
              </div>
              </div>
          </div>
          <br>
          
          <div class="card">
          <h3 class="card-header" style="text-align: center">Questions</h3>
          <div class="row">
          <div class="col-lg-6">
          <div style="margin: 20px">
            <!-- <h3><strong>Question 1</strong></h3> -->
            <p style="font-size:20px;">I enjoy engaging in outdoor activities</p> 
            <div class="col-lg-4">
            <div class="form-group">
              <select class="form-control" id="question1" required>
                <option value = "" selected disabled>Select an option</option>
                <option value = 1>1 (Strongly Disagree)</option>
                <option value = 2>2</option>
                <option value = 3>3</option>
                <option value = 4>4</option>
                <option value = 5>5 (Strongly Agree)</option>
              </select>
            </div>  
            </div>        
          </div>

          <div style="margin: 20px">
            <!-- <h3><strong>Question 2</strong></h3> -->
            <p style="font-size:20px;">I read a lot for pleasure</p> 
            <div class="col-lg-4">
            <div class="form-group">
              <select class="form-control" id="question2">
                <option value = "" selected disabled>Select an option</option>
                <option value = 1>1 (Strongly Disagree)</option>
                <option value = 2>2</option>
                <option value = 3>3</option>
                <option value = 4>4</option>
                <option value = 5>5 (Strongly Agree)</option>
              </select>
            </div>  
            </div>        
          </div>

          <div style="margin: 20px">
            <!-- <h3><strong>Question 3</strong></h3> -->
            <p style="font-size:20px;">I prefer going out to eat versus cooking at home</p> 
            <div class="col-lg-4">
            <div class="form-group">
              <select class="form-control" id="question3">
                <option value = "" selected disabled>Select an option</option>
                <option value = 1>1 (Strongly Disagree)</option>
                <option value = 2>2</option>
                <option value = 3>3</option>
                <option value = 4>4</option>
                <option value = 5>5 (Strongly Agree)</option>
              </select>
            </div>  
            </div>        
          </div>

          <div style="margin: 20px">
            <!-- <h3><strong>Question 4</strong></h3> -->
            <p style="font-size:20px;">I enjoy watching sports</p> 
            <div class="col-lg-4">
            <div class="form-group">
              <select class="form-control" id="question4">
                <option value = "" selected disabled>Select an option</option>
                <option value = 1>1 (Strongly Disagree)</option>
                <option value = 2>2</option>
                <option value = 3>3</option>
                <option value = 4>4</option>
                <option value = 5>5 (Strongly Agree)</option>
              </select>
            </div>  
            </div>        
          </div>
  
          <div style="margin: 20px">
            <!-- <h3><strong>Question 5</strong></h3> -->
            <p style="font-size:20px;">I think college is important</p> 
            <div class="col-lg-4">
            <div class="form-group">
              <select class="form-control" id="question5">
                <option value = "" selected disabled>Select an option</option>
                <option value = 1>1 (Strongly Disagree)</option>
                <option value = 2>2</option>
                <option value = 3>3</option>
                <option value = 4>4</option>
                <option value = 5>5 (Strongly Agree)</option>
              </select>
            </div>  
            </div>        
          </div>
          </div> <!-- End col 6-->

          <div class="col-lg-6">
          <div style="margin: 20px">
            <!-- <h3><strong>Question 6</strong></h3> -->
            <p style="font-size:20px;">I watch a lot of movies</p> 
            <div class="col-lg-4">
            <div class="form-group">
              <select class="form-control" id="question6">
                <option value = "" selected disabled>Select an option</option>
                <option value = 1>1 (Strongly Disagree)</option>
                <option value = 2>2</option>
                <option value = 3>3</option>
                <option value = 4>4</option>
                <option value = 5>5 (Strongly Agree)</option>
              </select>
            </div>  
            </div>        
          </div>

          <div style="margin: 20px">
            <!-- <h3><strong>Question 7</strong></h3> -->
            <p style="font-size:20px;">I exercise every day</p> 
            <div class="col-lg-4">
            <div class="form-group">
              <select class="form-control" id="question7">
                <option value = "" selected disabled>Select an option</option>
                <option value = 1>1 (Strongly Disagree)</option>
                <option value = 2>2</option>
                <option value = 3>3</option>
                <option value = 4>4</option>
                <option value = 5>5 (Strongly Agree)</option>
              </select>
            </div>  
            </div>        
          </div>

          <div style="margin: 20px">
            <!-- <h3><strong>Question 8</strong></h3> -->
            <p style="font-size:20px;">I enjoy being in a small intimate group versus a party</p> 
            <div class="col-lg-4">
            <div class="form-group">
              <select class="form-control" id="question8">
                <option value = "" selected disabled>Select an option</option>
                <option value = 1>1 (Strongly Disagree)</option>
                <option value = 2>2</option>
                <option value = 3>3</option>
                <option value = 4>4</option>
                <option value = 5>5 (Strongly Agree)</option>
              </select>
            </div>  
            </div>        
          </div>
  
          <div style="margin: 20px">
            <!-- <h3><strong>Question 9</strong></h3> -->
            <p style="font-size:20px;">I enjoy travelling to other countries</p> 
            <div class="col-lg-4">
            <div class="form-group">
              <select class="form-control" id="question9">
                <option value = "" selected disabled>Select an option</option>
                <option value = 1>1 (Strongly Disagree)</option>
                <option value = 2>2</option>
                <option value = 3>3</option>
                <option value = 4>4</option>
                <option value = 5>5 (Strongly Agree)</option>
              </select>
            </div>  
            </div>        
          </div>
  
          <div style="margin: 20px">
            <!-- <h3><strong>Question 10</strong></h3> -->
            <p style="font-size:20px;">I enjoy trying new experiences</p> 
            <div class="col-lg-4">
            <div class="form-group">
              <select class="form-control" id="question10">
                <option value = "" selected disabled>Select an option</option>
                <option value = 1>1 (Strongly Disagree)</option>
                <option value = 2>2</option>
                <option value = 3>3</option>
                <option value = 4>4</option>
                <option value = 5>5 (Strongly Agree)</option>
              </select>
            </div>  
            </div>        
          </div>
          </div> <!-- end col 6-->

          </div>  <!-- end of row-->
              <button type="submit" class="btn btn-primary btn-block submit">Submit</button>
          </form>
          </div> <!-- end of card -->
      </div>
  </div>
  </div>


  <!-- Display friend -->
  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="friendName"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div id="friend-img"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  </div> <!-- End container -->

</body>
</html>

<!-- BELOW CODE IS CRITICAL. IT HANDLES HOW FORM DATA IS SENT TO OUR SERVER -->
<script type="text/javascript">

    // In this code below we create the Front-end JavaScript which "POSTS" our form data to our express server.
    // In essence, when the user hits submit, jQuery grabs all of the fields then sends a post request to our api
    // Our api recognizes the route (/api/survey)... and then runs the associated code (found in apiRoutes.js).
    // In this case the associated code "saves" the data to the friends.js file

    $(".submit").on("click", function(event) {
      event.preventDefault();

      if (!validateForm())
        return;

      let name = $("#your-name").val().trim();
      let photo = $("#your-pic").val().trim();
      let source = [];

      // Convert the question answers to numbers so we can do math on them
      source.push(parseInt($("#question1").val().trim()));
      source.push(parseInt($("#question2").val().trim()));
      source.push(parseInt($("#question3").val().trim()));
      source.push(parseInt($("#question4").val().trim()));
      source.push(parseInt($("#question5").val().trim()));
      source.push(parseInt($("#question6").val().trim()));
      source.push(parseInt($("#question7").val().trim()));
      source.push(parseInt($("#question8").val().trim()));
      source.push(parseInt($("#question9").val().trim()));
      source.push(parseInt($("#question10").val().trim()));

      // Create an object we can push around
      var myData = {
        name: name,
        photo: photo,
        scores: source
      };

      console.log("Before FindMeAFriend ", myData);

      // Find me a new best friend
      return(findMeAfriend(myData));
    });
  
// This function validates the form data an ensures all the fields are filled out
// If they aren't, we'll send an error to the user
function validateForm() 
{

    var x = $("#your-name").val();
    var y = $("#your-pic").val();

    console.log("Validate form name = ", x, "URL = ", y);
    console.log("Questions", ($("#question1").val()));

    if (x == "" || y == "")
    {
        alert("Name and Photo URL must be filled out");
        return false;
    }

    if ((($("#question1").val()) == null) || (($("#question2").val()) == null) || (($("#question3").val()) == null) ||
    (($("#question4").val()) == null) || (($("#question5").val()) == null) || (($("#question6").val()) == null) ||
    (($("#question7").val()) == null) || (($("#question8").val()) == null) || (($("#question9").val()) == null) ||
    (($("#question10").val()) == null))
    {
        alert("All questions must be answered");
        return false;
    }

    return true;
}

// This is the heart of the application.  It will compare the entered data to the data in the database and find 
// the best "fit" and display it to the user
function findMeAfriend(myData) 
{
// Here we get the location of the root page.
// We use this instead of explicitly saying the URL is localhost:3001 because the url will change when we deploy.
var currentURL = window.location.origin;
console.log("FindMeAFriend", myData);


// The AJAX function uses the URL of our API to GET the data associated with it (initially set to localhost)
$.ajax({ url: currentURL + "/api/friends", method: "GET" })
  .then(function(friendData) {

  // Here we are logging the URL so we have access to it for troubleshooting
    console.log("------------------------------------");
    console.log("URL: " + currentURL + "/api/friends");
    console.log("------------------------------------");

    // Here we then log the friendData to console, where it will show up as an object.
    console.log("Pull friends ", friendData);
    console.log("------------------------------------");

    var myNewBestFriend = "";
    let myBestie = 0;
    
    // Loop through each possible friend and calculate compatibility (Less is better)
    for (var i = 0; i < friendData.length; i++) 
    {
      
      let diff = 0;

      for (var j=0; j < myData.scores.length; j++)
      {      
        diff += Math.abs(myData.scores[j] - friendData[i].scores[j]);
      }

      console.log("Possible friend ", friendData[i].name, " score: ", diff);

      if (i == 0 || diff < myBestie)
      {
        myBestie = diff;
        myNewBestFriend = friendData[i];
      }
      
    }  // End outer for loop

    console.log("My new best friend", myNewBestFriend);

    // Found my new best friend.  Show who they are
    // Modal logic here
    // Creating and storing the image tag
    $("#friendName").text("Your New Best Friend is " + myNewBestFriend.name);
    var friendImage = $("<img>");
    friendImage.attr("src", myNewBestFriend.photo);
    friendImage.addClass("image-responsive");
    friendImage.attr("width", "400px");
    friendImage.addClass("center");
    $("#friend-img").html(friendImage)
    $('#myModal').modal('show')

    // After finding a friend, add our data to the friends DB
    return(addMe(myData));

  });
}

// This function will add the data entered to the friend database
function addMe(newFriend)
{
  console.log("addMe: adding ", newFriend);
  $.post("/api/friends", newFriend,
    function(data) {

      console.log("Added: ", data);

      // Reset the form
      var form = document.getElementById("myForm");
      form.reset();
      return(false);

    });
}

</script>

